server {
	listen 80 default_server;
	listen [::]:80 default_server;
	server_name _;

	rewrite ^/sitemap_index\.xml$ /index.php?sitemap=1 last;
	rewrite ^/([^/]+?)-sitemap([0-9]+)?\.xml$ /index.php?sitemap=$1&sitemap_n=$2 last;
	
	location = /favicon.ico { log_not_found off; access_log off; }
	location = /robots.txt { allow all; log_not_found off; access_log off; }
	location ~ /\. { deny all; access_log off; log_not_found off; } 

	root /var/www/html;
	index index.html index.htm index.php;
	
	# Nginx 1.10 or later
	#expires $expires;
	#add_header Cache-Control public;
		
	location = /health_check {
		stub_status     on;
		allow           127.0.0.1;
		allow           ::1;
		allow		10.0.0.0/8;
		allow		172.16.0.0/12;
		allow		192.168.0.0/16;
		deny            all;
		access_log      off;
	} 
	
	location / {
		if (!-f $request_filename){ set $rule_0 1$rule_0; }
		if (!-d $request_filename){ set $rule_0 2$rule_0; }
		if ($rule_0 = "21"){ rewrite ^/(.*)$ /index.php/$1 last; }
		try_files $uri $uri/ /index.php?q=$uri&$args;
	}

	location ~\.php($|/) {
		fastcgi_buffers                 16 256k;
		fastcgi_buffer_size             256k;
		fastcgi_connect_timeout         2s;
		fastcgi_send_timeout            12s;
		fastcgi_read_timeout            360s;
		fastcgi_busy_buffers_size       256k;
		fastcgi_temp_file_write_size    256k;
		fastcgi_ignore_headers          Cache-Control Expires Set-Cookie;
		fastcgi_split_path_info 	^(.+\.php)(/.+)$;
		fastcgi_index 			index.php;
		include snippets/fastcgi-php.conf;
		fastcgi_pass unix:/run/php/php5.6-fpm.sock;
	}
}
